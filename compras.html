<!DOCTYPE html>  
<html lang="pt-br">  
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Comprar - Água Pura Premium</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  const SUPABASE_URL = "https://ttqetzagmjsjiibchsqo.supabase.co";
  const SUPABASE_KEY = "sb_publishable_SxV6az0prQtpuyP4VdstkQ_nP38A3rw";

  window.supabaseClient = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
  );
</script>

<style>
  :root{
    --accent:#00b894;
    --primary:#007aff;
    --glass: rgba(255,255,255,0.06);
    --card-shadow: 0 18px 40px rgba(3,13,26,0.08);
  }
  *{box-sizing:border-box}
  html,body{
  margin:0;
  padding:0;
  min-height:100%;
  overflow-y:auto;
  }
  body{
    margin:0;
    font-family:'Poppins',system-ui,Segoe UI,Roboto,Helvetica,Arial;
    -webkit-font-smoothing:antialiased;
    background: linear-gradient(135deg,#0b2a3a,#062033);
    color: #fff;
    display:flex;
    justify-content:center;
    padding:20px;
  }

  .wrap{
    width:100%;
    max-width:980px;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border-radius:14px;
    padding:28px;
    box-shadow: var(--card-shadow);
    overflow:hidden;
  }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:28px;
    align-items:start;
  }

  .left{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:18px;
  }
  .product-photo{
    width:100%;
    max-width:420px;
    background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:18px;
    display:flex;
    justify-content:center;
    align-items:center;
  }
  .product-photo img{
    width:280px;
    max-width:86%;
    height:auto;
    display:block;
    filter: drop-shadow(0 30px 60px rgba(0,0,0,0.6));
    transform: translateY(0);
    transition: transform .8s ease;
  }
  .product-photo img.float{ animation: float 5s ease-in-out infinite; }
  @keyframes float { 0%{transform:translateY(0)}50%{transform:translateY(-18px)}100%{transform:translateY(0)} }

  .right{
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .title{
    font-size:22px;
    font-weight:800;
    line-height:1.05;
    color: #e8fbff;
    margin-bottom:6px;
  }
  .stars{
    color:#ffd166;
    font-weight:700;
    margin-bottom:6px;
  }
  .reviews{
    font-size:13px;
    color:#cfeff6;
    margin-bottom:8px;
  }
  .price-row{
    display:flex;
    align-items:center;
    gap:14px;
    margin:8px 0 6px 0;
  }
  .price{
    font-size:28px;
    font-weight:900;
    color: #00e0ff;
  }
  .shipping{
    font-size:14px;
    color:#dff9ff;
  }
  .payments{
    font-size:14px;
    color:#dff9ff;
    margin-top:12px;
    line-height:1.5;
  }

  .cart-actions{
    margin-top:20px;
    display:flex;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
  }
  .qty{
    display:flex;
    align-items:center;
    gap:8px;
  }
  .qty input{
    width:72px;
    padding:10px;
    border-radius:10px;
    border:none;
    text-align:center;
    font-weight:700;
    background: rgba(255,255,255,0.04);
    color:#fff;
  }
  .btn-select{
    padding:12px 18px;
    border-radius:12px;
    background:var(--primary);
    color:#fff;
    border: none;
    font-weight:700;
    cursor:pointer;
  }
  .btn-pay{
    flex:1;
    padding:12px 16px;
    border-radius:12px;
    background: #6b7280; /* disabled look */
    color:#fff;
    border:none;
    font-weight:800;
    cursor:not-allowed;
  }
  .btn-pay.active{
    background:var(--accent);
    cursor:pointer;
    box-shadow: 0 10px 30px rgba(0,184,148,0.14);
  }

  .details{
    margin-top:22px;
    background: rgba(255,255,255,0.02);
    padding:18px;
    border-radius:12px;
  }
  .details h3{
    margin:0 0 10px 0;
    color:#aef0ff;
    font-size:16px;
  }
  .details p{ color:#dff9ff; font-size:14px; line-height:1.6; margin:0 0 10px 0;}
  .specs p{ color:#e6fbff; font-size:14px; margin:6px 0; }

  /* Order summary (inserted before pay button) */
  #orderSummary{
    margin-top:15px;
    display:none;
    background: rgba(255,255,255,0.03);
    padding:12px;
    border-radius:10px;
  }
  #orderSummary .total{ font-size:18px; font-weight:800; color:#00e0ff; margin-top:6px; }
  #orderSummary .code{ font-size:13px; color:#aef0ff; margin-top:8px; }

  /* Modal / sheet */
  .overlay{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.55);
    z-index:60;
    justify-content:center;
    align-items:flex-end;
  }
  .sheet{
    width:100%;
    max-width:440px;
    background:linear-gradient(180deg,#04232f,#01303a);
    color:#fff;
    border-radius:14px 14px 0 0;
    padding:18px;
    box-shadow:0 -18px 50px rgba(0,0,0,0.6);
  }
  .sheet h4{ margin:0 0 14px 0; font-size:18px; }
  .pay-option{
    background: rgba(255,255,255,0.03);
    padding:12px;
    border-radius:10px;
    margin-bottom:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    cursor:pointer;
    border:1px solid rgba(255,255,255,0.03);
  }
  .pay-option .label{ font-weight:700; color:#eaffff; }
  .pay-detail{ font-size:13px; color:#cfeff6; }

  .pix-box{
    margin-top:12px;
    background:linear-gradient(180deg,#eafcff,#dff8ff);
    color:#03323a;
    padding:12px;
    border-radius:10px;
    text-align:center;
    font-weight:800;
  }
  .card-form input{
    width:100%;
    padding:10px;
    margin-top:8px;
    border-radius:8px;
    border:none;
    background: rgba(255,255,255,0.06);
    color:#fff;
  }

  @media (max-width:900px){
    .grid{ grid-template-columns: 1fr; }
    .left{ order:0 }
    .right{ order:1 }
    .wrap{ padding:16px; }
    body{ padding:12px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="grid" role="main">

      <!-- LEFT: product photo centered between name and reviews -->
      <div class="left" aria-hidden="false">
        <div style="text-align:center">
          <div class="title" style="font-size:20px;font-weight:800;color:#e8fbff;">Galão de Água Mineral 20L Premium</div>
        </div>

        <!-- image exactly between name and reviews -->
        <div class="product-photo" aria-hidden="false">
          <!-- stable PNG generic galão for testing -->
          <img src="https://pngimg.com/uploads/water_bottle/water_bottle_PNG9897.png" alt="Galão 20L Água Premium" class="float">
        </div>

        <div style="text-align:center">
          <div class="stars">★★★★★</div>
          <div class="reviews">(247 avaliações verificadas)</div>
        </div>
      </div>

      <!-- RIGHT: product info -->
      <div class="right" role="region" aria-label="Informações do produto">
        <div class="price-row">
          <div class="price">R$ 22,90</div>
        </div>

        <div class="shipping">Frete <strong style="color:#7ef5c7">GRÁTIS</strong> para Marambaia - Itaboraí RJ</div>

        <div class="payments"><strong>Formas de pagamento:</strong> Pix • Cartão de Débito • Cartão de Crédito (taxa R$ 1,00 por compra no crédito)</div>

        <!-- Cart area -->
        <div class="cart-actions" style="margin-top:18px;">
          <div style="flex:1">
            <label style="font-size:13px;color:#dff9ff;display:block;margin-bottom:6px">Quantidade</label>
            <div style="display:flex;gap:8px;align-items:center">
              <div class="qty">
                <input id="qty" type="number" value="1" min="1" max="100" onchange="qtyChanged()" />
              </div>
            </div>
          </div>

          <div style="min-width:140px">
            <button class="btn-select" onclick="selectProduct()">Selecionar Produto</button>
          </div>
        </div>

        <!-- ORDER SUMMARY (total + code) - inserted before pay button -->
        <div id="orderSummary">
          <div style="font-size:14px;color:#cfeff6;">Total do Pedido:</div>
          <div id="totalValue" class="total">R$ 0,00</div>
          <div id="orderCode" class="code"></div>
        </div>

        <button id="payBtn" class="btn-pay" disabled>Pagar Agora</button>

        <!-- Details like Mercado Livre -->
        <div class="details" aria-labelledby="details-title">
          <h3 id="details-title">Descrição</h3>
          <p>Água mineral natural de alta pureza, distribuída em galões lacrados e higienizados. Ideal para casa, comércio ou escritório. Entrega rápida e segura em Itaboraí.</p>

          <h3 style="margin-top:12px">Características</h3>
          <div class="specs">
            <p><strong>Marca:</strong> Água Pura Premium</p>
            <p><strong>Modelo:</strong> Galão Mineral 20L Lacrado</p>
            <p><strong>Capacidade:</strong> 20 Litros</p>
            <p><strong>Tipo:</strong> Água Mineral Natural</p>
            <p><strong>Entrega:</strong> Até 40 minutos (dependendo da região)</p>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Overlay / sheet -->
  <div id="overlay" class="overlay" role="dialog" aria-hidden="true" onclick="closeSheet()">
    <div class="sheet" role="document" onclick="event.stopPropagation()">
      <h4>Escolha a forma de pagamento</h4>

      <div class="pay-option" onclick="selectPayment('pix')">
        <div class="label">Pix</div>
        <div class="pay-detail">Pagar via chave Pix</div>
      </div>

      <div class="pay-option" onclick="selectPayment('debit')">
        <div class="label">Cartão de Débito</div>
        <div class="pay-detail">Pagamento à vista</div>
      </div>

      <div class="pay-option" onclick="selectPayment('credit')">
        <div class="label">Cartão de Crédito</div>
        <div class="pay-detail">Taxa R$ 1,00 aplicada</div>
      </div>

      <div id="paymentArea"></div>

      <div style="margin-top:14px; text-align:center;">
        <button style="padding:10px 16px;border-radius:10px;border:none;background:transparent;color:#aef0ff" onclick="closeSheet()">Cancelar</button>
      </div>
    </div>
  </div>

<script>
  // state + pricing
  let productSelected = false;
  let currentPayment = null;
  const unitPrice = 22.90;
  let orderId = null;

  function generateOrderId(){
    return Math.floor(1000000 + Math.random() * 9000000); // 7-digit
  }

  function formatBRL(value){
    return value.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  }

  function calculateTotal(applyCreditFee = false){
    const qty = parseInt(document.getElementById('qty').value || 1, 10);
    let total = unitPrice * qty;
    if(applyCreditFee) total += 1.00;
    return total;
  }

  function updateSummary(){
    const summary = document.getElementById('orderSummary');
    const totalText = document.getElementById('totalValue');
    const codeText = document.getElementById('orderCode');

    const total = calculateTotal(false);

    totalText.innerText = formatBRL(total);
    summary.style.display = 'block';
    codeText.innerText = "Código do Pedido: " + orderId;
  }

  function selectProduct(){
    productSelected = true;
    orderId = generateOrderId();

    updateSummary();

    const payBtn = document.getElementById('payBtn');
    payBtn.disabled = false;
    payBtn.classList.add('active');
    payBtn.onclick = openSheet;
  }

  function qtyChanged(){
    if(productSelected){
      updateSummary();
    }
  }

  function openSheet(){
    if(!productSelected) return;
    const overlay = document.getElementById('overlay');
    overlay.style.display = 'flex';
    overlay.setAttribute('aria-hidden','false');
    document.getElementById('paymentArea').innerHTML = '';
  }

  function closeSheet(){
    const overlay = document.getElementById('overlay');
    overlay.style.display = 'none';
    overlay.setAttribute('aria-hidden','true');
    currentPayment = null;
    document.getElementById('paymentArea').innerHTML = '';
  }

  function selectPayment(type){
    currentPayment = type;
    const area = document.getElementById('paymentArea');
    area.innerHTML = '';

    if(type === 'pix'){
      const total = calculateTotal(false);

      area.innerHTML = `
        <div class="pix-box">
          <div>Total a pagar:</div>
          <div style="font-size:20px;margin-top:6px">${formatBRL(total)}</div>
          <div style="margin-top:12px">Chave Pix:</div>
          <div style="font-size:18px;margin-top:6px">202.978.417-69</div>
          <div style="margin-top:10px;font-size:13px">Pedido: ${orderId}</div>
        </div>
      `;
    } else if(type === 'debit'){
      const total = calculateTotal(false);

      area.innerHTML = `
        <div style="margin-bottom:10px;font-weight:700;color:#dff9ff;">
          Total a pagar: ${formatBRL(total)}
        </div>
        <div class="card-form">
          <input placeholder="Número do cartão">
          <input placeholder="Nome do titular">
          <div style="display:flex;gap:8px;">
            <input placeholder="MM/AA" style="flex:1">
            <input placeholder="CVC" style="width:110px">
          </div>
          <div style="margin-top:10px;display:flex;gap:8px;">
            <button style="flex:1;padding:10px;border-radius:8px;border:none;background:var(--primary);color:#fff;font-weight:700" onclick="simulateDebitPay()">Confirmar Pagamento</button>
          </div>
        </div>
      `;
    } else if(type === 'credit'){
      const total = calculateTotal(true);

      area.innerHTML = `
        <div style="margin-bottom:6px;color:#cfeff6;">Taxa crédito: R$ 1,00</div>
        <div style="margin-bottom:10px;font-weight:700;color:#dff9ff;">
          Total com taxa: ${formatBRL(total)}
        </div>
        <div style="font-size:13px;margin-bottom:10px;">Pedido: ${orderId}</div>
        <div class="card-form">
          <input placeholder="Número do cartão">
          <input placeholder="Nome do titular">
          <div style="display:flex;gap:8px;">
            <input placeholder="MM/AA" style="flex:1">
            <input placeholder="CVC" style="width:110px">
          </div>
          <div style="margin-top:10px;display:flex;gap:8px;">
            <button style="flex:1;padding:10px;border-radius:8px;border:none;background:var(--primary);color:#fff;font-weight:700" onclick="simulateCreditPay()">Confirmar Pagamento</button>
          </div>
        </div>
      `;
    }
  }

  function simulateCreditPay(){
    alert('Pagamento simulado (crédito) recebido.\nPedido: ' + orderId);
    closeSheet();
    showConfirmation();
  }

  function simulateDebitPay(){
    alert('Pagamento simulado (débito) recebido.\nPedido: ' + orderId);
    closeSheet();
    showConfirmation();
  }

  function copyPix(){
    const key = '202.978.417-69';
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(key).then(()=> {
        alert('Chave Pix copiada: ' + key + '\nPague e volte aqui para confirmar.');
      }).catch(()=> {
        alert('Código Pix: ' + key);
      });
    } else {
      alert('Código Pix: ' + key);
    }
  }

  function showConfirmation(){
    const conf = document.createElement('div');
    conf.style.position='fixed';
    conf.style.left='50%';
    conf.style.top='50%';
    conf.style.transform='translate(-50%,-50%)';
    conf.style.background='linear-gradient(180deg,#eafff6,#d6fff0)';
    conf.style.color='#023';
    conf.style.padding='18px';
    conf.style.borderRadius='12px';
    conf.style.boxShadow='0 12px 40px rgba(0,0,0,0.3)';
    conf.innerHTML = '<strong>Compra confirmada!</strong><div style="margin-top:8px">Pedido: ' + orderId + '</div><div style="margin-top:12px;text-align:center"><button style="padding:8px 12px;border-radius:8px;border:none;background:#007aff;color:#fff;font-weight:700" onclick="this.parentNode.parentNode.remove()">Fechar</button></div>';
    document.body.appendChild(conf);
  }

  // initialize
  (function init(){
    const btn = document.getElementById('payBtn');
    btn.disabled = true;
  })();
</script>
</body>
</html>
